!function(){angular.module("Controllers",["Sections","Food","OrderRecap","NewOrder"])}(),function(){var t=angular.module("Food",["Services"]);t.controller("FoodCtrl",["$scope","menu",function(t,e){t.foodList=e.getFoodList(t.appstate.section),t.orderFood=function(e){t.appstate.order.addFood({food:e,quantity:1})},t.reduceFood=function(e){var n=t.appstate.order.getItem({food:e});t.appstate.order.reduceQuantity(n)}}])}(),function(){var t=angular.module("NewOrder",["Services"]);t.controller("NewOrderCtrl",["$scope","restaurant","waiter",function(t,e,n){function o(e){console.log("Confirming order",e),t.appstate.room=e.room,t.appstate.order=n.createOrder(e.tables),t.appstate.setView("sections")}var r={room:{},tables:[],selectTable:function(t){-1==r.tables.indexOf(t)?r.tables.push(t):r.tables.splice(r.tables.indexOf(t),1)},isSelected:function(t){return-1!=r.tables.indexOf(t)}};t.neworder=r,t.confirmTables=o,t.rooms=e.getRooms(),t.neworder.room=t.rooms[0],t.tables=e.getTables(t.neworder.room)}])}(),function(){var t=angular.module("OrderRecap",["Services"]);t.controller("OrderCtrl",["$scope",function(t){t.orderContent=t.appstate.order.getContent(),t.removeFood=function(e){console.log(e,"removing!"),t.appstate.order.removeItem(e)},t.orderFood=function(e){t.appstate.order.addFood({food:e.food,quantity:1})},t.reduceFood=function(e){t.appstate.order.reduceQuantity(e)},t.showNote=function(e){t.note={visible:!0,item:e},console.log("Please add note :D",e.food.name,e.quantity)},t.saveNote=function(e){console.log(e),t.appstate.order.addNote(e.item,e.text),console.log(t.appstate.order.getContent())}}])}(),function(){var t=angular.module("RMT",["Services","Controllers","Directives","templates","ngTouch"]);t.controller("RMTCtrl",["$scope","waiter","menu",function(t,e,n){t.appstate=function(){var t=[];return{currentView:"table-selection",canGoBack:!1,setView:function(e){this.currentView!==e&&(t.push(this.currentView),this.currentView=e,this.canGoBack=!0)},goBack:function(){t.length&&(this.currentView=t.pop(),0===t.length&&(this.canGoBack=!1))}}}()}]),t.controller("TablesCtrl",["$scope","restaurant","waiter",function(t,e,n){t.selectRoom=function(n){t.appstate.room=n,t.tables=e.getTables(n)},t.selectTable=function(e){t.appstate.table=e,t.appstate.order=n.getOrder(e),t.appstate.setView("sections")},t.rooms=e.getRooms(),t.appstate.room=t.rooms[0],t.tables=e.getTables(t.appstate.room)}])}(),function(){var t=angular.module("Sections",["Services"]);t.controller("SectionsCtrl",["$scope","menu",function(t,e){e.getSections().then(function(e){t.sections=e}),t.selectSection=function(e){t.appstate.section=e,t.appstate.setView("food")}}])}(),function(){var t=angular.module("Menu",[]);t.factory("menu",["$http",function(t){function e(t){var e=new Promise(function(e,o){Papa.parse(t,{download:!0,complete:function(t){var o;$.each(t.data,function(t,e){var r,a=e.length;for(r=0;a>r;r++)e[r]&&e.push(e[r]);if(e.splice(0,a),0!==e.length)if(1==e.length)o=e[0],n[o]=[];else{var i={name:e[0],price:parseFloat(e[1].replace(/,/,"."))};n[o].push(i)}}),e(n)}})});return e}var n={},o=e("/assets/menu/menu_parsable.csv");return{getSections:function(){return o.then(function(t){return Object.getOwnPropertyNames(t)})},getFoodList:function(t){return n[t]}}}])}(),function(){var t=angular.module("Order",[]);t.factory("orderGenerator",function(){var t=function(t){var e=[];return{tablesArray:t,getContent:function(){return e},getTotal:function(){return e.reduce(function(t,e){return t+=e.quantity*e.food.price},0)},getCount:function(){return e.length},addFood:function(t){var n=this.getItem(t);n?n.quantity+=t.quantity:e.push({food:t.food,quantity:t.quantity,note:t.note||void 0})},addNote:function(t,e){t.note&&t.note!=e?t.note=e:t.note||(this.reduceQuantity(t),0===t.quantity&&this.removeItem(t),this.addFood({food:t.food,quantity:1,note:e}))},reduceQuantity:function(t){0!==t.quantity&&(t.quantity-=1)},getItem:function(t){var n=e.find(function(e){var n=e.food.name==t.food.name,o=e.note==t.note;return t.note||e.note?n&&o:n});return n},removeItem:function(t){e.splice(e.indexOf(t),1)},getQuantity:function(t){var e=this.getItem({food:t});return e?e.quantity:0}}};return{createOrder:function(e){return new t(e)}}})}(),function(){var t=angular.module("Restaurant",[]);t.factory("restaurant",function(){for(var t=[],e=0,n=0;3>n;n+=1){var o={};o.id=n,o.tables=[];for(var r=0;5>r;r+=1)o.tables.push({id:e++});t.push(o)}return{getRooms:function(){return t},getTables:function(e){var n=t.indexOf(e);return-1!=n?t[n].tables:void 0}}})}(),function(){var t=angular.module("RmtAPI",[]);t.factory("rmtAPI",["$http",function(t){function e(){console.log("Success!")}function n(){console.log("Fail!"),Promise.reject()}return{sendOrder:function(o){return t.post("/printOrder",o).then(e,n)}}}])}(),function(){angular.module("Services",["Waiter","Restaurant","Menu","RmtAPI"])}(),function(){var t=angular.module("Waiter",["Order","RmtAPI"]);t.factory("waiter",["orderGenerator","rmtAPI",function(t,e){function n(t){var e=o.indexOf(t);o.splice(e,1)}var o=[];return{createOrder:function(e){var r=t.createOrder(e);return e.forEach(function(t){var e=this.getOrder(t);e&&(e.tablesArray.forEach(function(t){t.busy=!1}),n(e)),t.busy=!0}.bind(this)),o.push(r),r},getOrder:function(t){return o.find(function(e){return-1!=e.tablesArray.indexOf(t)})},sendOrder:function(t){var n=t.getContent();console.log("foods: ",t.getCount()),console.log("list of foods: ",n),e.sendOrder(t).then(function(){})}}}])}(),function(){angular.module("Directives",["FoodEntry"])}(),function(){var t=angular.module("FoodEntry",[]);t.directive("foodEntry",function(){return{restrict:"E",transclude:!0,scope:{name:"=",quantity:"=",note:"=",onplus:"&",onminus:"&",onnote:"&?"},templateUrl:"directives/foodEntry.html",link:function(t,e,n){t.$watch("showQuantity",function(e){e&&!t.quantity&&t.onplus()}),t.clicked=function(){t.onnote?t.showMiddleStep=!0:t.showQuantity=!0}}}})}();