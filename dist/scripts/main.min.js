!function(){angular.module("Directives",["FoodEntry"])}(),function(){var e=angular.module("FoodEntry",[]);e.directive("foodEntry",function(){return{restrict:"E",transclude:!0,scope:{name:"=",quantity:"=",note:"=",onplus:"&",onminus:"&",onnote:"&?"},templateUrl:"directives/foodEntry.html",link:function(e,t,n){e.$watch("showQuantity",function(t){t&&!e.quantity&&e.onplus()}),e.clicked=function(){e.onnote?e.showMiddleStep=!0:e.showQuantity=!0}}}})}(),function(){angular.module("Controllers",["FoodOrDrinks","Sections","Food","OrderRecap","NewOrder"])}(),function(){var e=angular.module("Food",["Services"]);e.controller("FoodCtrl",["$scope","menu",function(e,t){t.getFoodList(e.appstate.menuType,e.appstate.section).then(function(t){e.foodList=t}),e.orderFood=function(t){e.appstate.order.addFood({menuType:e.appstate.menuType,food:t,quantity:1})},e.reduceFood=function(t){var n=e.appstate.order.getItem({food:t});e.appstate.order.reduceQuantity(n)}}])}(),function(){var e=angular.module("FoodOrDrinks",[]);e.controller("FoodOrDrinksCtrl",["$scope",function(e){e.selectMenu=function(t){e.appstate.menuType=t,e.appstate.setView("sections")}}])}(),function(){var e=angular.module("NewOrder",["Services"]);e.controller("NewOrderCtrl",["$scope","restaurant","waiter",function(e,t,n){function o(t){console.log("Confirming order",t),e.appstate.room=t.room,e.appstate.order=n.createOrder(t.tables),e.appstate.setView("food-or-drinks")}function r(n){t.getTables(n).then(function(t){e.tables=t})}var a={room:{},tables:[],selectTable:function(e){-1==a.tables.indexOf(e)?a.tables.push(e):a.tables.splice(a.tables.indexOf(e),1)},isSelected:function(e){return-1!=a.tables.indexOf(e)}};e.neworder=a,e.confirmTables=o,e.$watch("neworder.room",r),t.getRooms().then(function(t){e.rooms=t,e.neworder.room=e.rooms[0],r(e.neworder.room)})}])}(),function(){var e=angular.module("OrderRecap",["Services"]);e.controller("OrderCtrl",["$scope","waiter",function(e,t){e.orderContent=e.appstate.order.getContent(),e.removeFood=function(t){console.log(t,"removing!"),e.appstate.order.removeItem(t)},e.orderFood=function(t){e.appstate.order.addFood({food:t.food,menuType:t.menuType,quantity:1,note:t.note})},e.reduceFood=function(t){e.appstate.order.reduceQuantity(t)},e.showNote=function(t){e.note={visible:!0,item:t,text:t.note},console.log("Please add note :D",t.food.name,t.quantity)},e.sendToKitchen=function(e){t.sendOrder(e)},e.sendInvoice=function(e){t.sendInvoice(e)},e.saveNote=function(t){console.log(t),e.appstate.order.addNote(t.item,t.text),console.log(e.appstate.order.getContent())}}])}(),function(){var e=angular.module("RMT",["Services","Controllers","Directives","templates","ngTouch"]);e.controller("RMTCtrl",["$scope","waiter","menu",function(e,t,n){e.appstate=function(){var e=[];return{currentView:"table-selection",canGoBack:!1,setView:function(t){this.currentView!==t&&(e.push(this.currentView),this.currentView=t,this.canGoBack=!0)},goBack:function(){e.length&&(this.currentView=e.pop(),0===e.length&&(this.canGoBack=!1))}}}()}]),e.controller("TablesCtrl",["$scope","restaurant","waiter",function(e,t,n){function o(n){t.getTables(n).then(function(t){e.tables=t})}function r(e){return function(t){return t[e]}}t.getRooms().then(function(t){e.rooms=t,e.appstate.room=t[0],o(e.appstate.room)}),e.selectRoom=function(t){e.appstate.room=t,o(e.appstate.room)},e.selectTable=function(t){e.appstate.table=t,e.appstate.order=n.getOrder(t),e.appstate.setView("sections")},e.activeOrdersCount=function(){return e.tables&&e.tables.length?e.tables.filter(r("busy")).length:void 0}}])}(),function(){var e=angular.module("Sections",["Services"]);e.controller("SectionsCtrl",["$scope","menu",function(e,t){t.getSections(e.appstate.menuType).then(function(t){e.sections=t}),e.selectSection=function(t){e.appstate.section=t,e.appstate.setView("food")}}])}(),function(){var e=angular.module("Menu",[]);e.factory("menu",["$http",function(e){function t(e){var t={},n=new Promise(function(n,o){Papa.parse(e,{download:!0,complete:function(e){var o;$.each(e.data,function(e,n){var r,a=n.length;for(r=0;a>r;r++)n[r]&&n.push(n[r]);if(n.splice(0,a),0!==n.length)if(1==n.length)o=n[0],t[o]=[];else{var u={name:n[0],price:parseFloat(n[1].replace(/,/,"."))};t[o].push(u)}}),n(t)}})});return n}function n(e){return{foodMenu:e[0],drinksMenu:e[1]}}var o,r="/assets/menu/menu_cibo.csv",a="/assets/menu/menu_bere.csv",u=t(r),i=t(a);return o=Promise.all([u,i]).then(n),{getSections:function(e){return o.then(function(t){return Object.getOwnPropertyNames(t[e])})},getFoodList:function(e,t){return o.then(function(n){return n[e][t]})}}}])}(),function(){var e=angular.module("Order",[]);e.factory("orderGenerator",function(){var e=function(e){var t=[];return{tablesArray:e,getContent:function(){return t},getTotal:function(){return t.reduce(function(e,t){return e+=t.quantity*t.food.price},0)},getCount:function(){return t.length},addFood:function(e){var n=this.getItem(e);n?n.quantity+=e.quantity:t.push({food:e.food,menuType:e.menuType,quantity:e.quantity,note:e.note||void 0})},addNote:function(e,t){e.note&&e.note!=t?e.note=t:e.note||(this.reduceQuantity(e),0===e.quantity&&this.removeItem(e),this.addFood({food:e.food,menuType:e.menuType,quantity:1,note:t}))},reduceQuantity:function(e){0!==e.quantity&&(e.quantity-=1)},getItem:function(e){var n=t.find(function(t){var n=t.food.name==e.food.name,o=t.note==e.note;return e.note||t.note?n&&o:n});return n},removeItem:function(e){t.splice(t.indexOf(e),1)},getQuantity:function(e){var t=this.getItem({food:e});return t?t.quantity:0}}};return{createOrder:function(t){return new e(t)}}})}(),function(){var e=angular.module("Restaurant",[]);e.factory("restaurant",["$http",function(e){function t(e){console.log(e),e.forEach(function(e,t){for(var o={name:e.name,id:t,tables:[]},r=0;r<e.tables;r++)o.tables.push({id:e.prefix+r,roomid:t});n.push(o)}),console.log(n)}var n=[],o=e.get("/assets/restaurant/rooms.json").then(function(e){t(e.data)});return{getRooms:function(){return o.then(function(){return n})},getTables:function(e){return o.then(function(){var t=n.indexOf(e);return-1!=t?n[t].tables:void 0})}}}])}(),function(){var e=angular.module("RmtAPI",[]);e.factory("rmtAPI",["$http",function(e){function t(){console.log("Success!")}function n(){console.log("Fail!"),Promise.reject()}return{sendOrder:function(o){return e.post("/printOrder",o).then(t,n)},sendInvoice:function(o){return e.post("/printInvoice",o).then(t,n)}}}])}(),function(){angular.module("Services",["Waiter","Restaurant","Menu","RmtAPI"])}(),function(){var e=angular.module("Waiter",["Order","RmtAPI"]);e.factory("waiter",["orderGenerator","rmtAPI",function(e,t){function n(e){var t=o.indexOf(e);o.splice(t,1)}var o=[];return{createOrder:function(t){var r=e.createOrder(t);return t.forEach(function(e){var t=this.getOrder(e);t&&(t.tablesArray.forEach(function(e){e.busy=!1}),n(t)),e.busy=!0}.bind(this)),o.push(r),r},getOrder:function(e){return o.find(function(t){return-1!=t.tablesArray.indexOf(e)})},sendOrder:function(e){var n={table:e.tablesArray.map(function(e){return e.id}).join(" + "),order:e.getContent()};console.log("Sending",n),t.sendOrder(n).then(function(){})},sendInvoice:function(e){var n={table:e.tablesArray.map(function(e){return e.id}).join(" + "),order:e.getContent(),total:e.getTotal()};console.log("Sending invoice",n),t.sendInvoice(n).then(function(){})}}}])}();